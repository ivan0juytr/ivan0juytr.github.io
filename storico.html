<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nasometro Digitale – Storico analisi</title>

    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
      :root {
        --green-50: #f0fdf4;
        --green-600: #16a34a;
        --yellow-50: #fefce8;
        --yellow-500: #eab308;
        --red-50: #fef2f2;
        --red-500: #ef4444;
        --blue-50: #eff6ff;
        --blue-600: #2563eb;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-900: #111827;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background-color: var(--gray-50);
        color: var(--gray-900);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      .page {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* Navbar */
      .navbar {
        background-color: #ffffff;
        border-bottom: 1px solid var(--gray-200);
      }

      .navbar-inner {
        max-width: 64rem;
        margin: 0 auto;
        padding: 0.75rem 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
      }

      .navbar-brand {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
        font-size: 1rem;
      }

      .navbar-links {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.9rem;
      }

      .nav-link {
        padding: 0.4rem 0.6rem;
        border-radius: 9999px;
        color: var(--gray-600);
      }

      .nav-link:hover {
        background-color: var(--gray-100);
        color: var(--gray-900);
      }

      .nav-link.active {
        background-color: var(--blue-50);
        color: var(--blue-600);
        font-weight: 500;
      }

      main {
        flex: 1;
      }

      .main-inner {
        max-width: 64rem;
        margin: 0 auto;
        padding: 2rem 1rem 3rem;
      }

      h1 {
        font-size: 1.4rem;
        margin: 0 0 0.25rem;
      }

      .page-subtitle {
        margin: 0 0 1.5rem;
        font-size: 0.9rem;
        color: var(--gray-600);
      }

      .layout {
        display: grid;
        grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
        gap: 1.25rem;
        align-items: flex-start;
      }

      @media (max-width: 900px) {
        .layout {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .card {
        background-color: #ffffff;
        border-radius: 0.75rem;
        padding: 1.25rem;
        border: 1px solid var(--gray-100);
      }

      .card-header-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
      }

      .card-title {
        font-size: 0.98rem;
        font-weight: 600;
        margin: 0;
      }

      .card-subtitle {
        margin: 0;
        font-size: 0.8rem;
        color: var(--gray-600);
      }

      /* Filter chips */
      .filters-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
        flex-wrap: wrap;
      }

      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
      }

      .chip-filter {
        padding: 0.25rem 0.7rem;
        border-radius: 9999px;
        border: 1px solid var(--gray-200);
        font-size: 0.78rem;
        color: var(--gray-600);
        background-color: #ffffff;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
      }

      .chip-filter.active {
        border-color: var(--blue-600);
        background-color: var(--blue-50);
        color: var(--blue-600);
      }

      .btn-ghost-sm {
        border: none;
        background: transparent;
        color: var(--gray-600);
        font-size: 0.8rem;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.2rem 0.2rem;
      }

      .btn-ghost-sm:hover {
        color: var(--gray-900);
      }

      /* Table / list */
      .table-header {
        display: grid;
        grid-template-columns: 2.4fr 1.2fr 1.2fr 1fr;
        gap: 0.5rem;
        padding: 0.4rem 0.5rem;
        border-radius: 0.5rem;
        background-color: var(--gray-50);
        font-size: 0.75rem;
        color: var(--gray-600);
        margin-bottom: 0.3rem;
      }

      .table-body {
        border-radius: 0.5rem;
        border: 1px solid var(--gray-100);
        max-height: 420px;
        overflow: auto;
      }

      .table-row {
        display: grid;
        grid-template-columns: 2.4fr 1.2fr 1.2fr 1fr;
        gap: 0.5rem;
        padding: 0.45rem 0.5rem;
        align-items: center;
        font-size: 0.82rem;
      }

      .table-row:nth-child(odd) {
        background-color: #ffffff;
      }

      .table-row:nth-child(even) {
        background-color: #f9fafb;
      }

      .item-name-cell {
        display: flex;
        align-items: center;
        gap: 0.45rem;
      }

      .item-icon {
        width: 26px;
        height: 26px;
        border-radius: 9999px;
        background-color: var(--gray-100);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .item-name-main {
        display: flex;
        flex-direction: column;
        gap: 0.1rem;
      }

      .item-name-title {
        font-weight: 500;
        font-size: 0.86rem;
      }

      .item-name-sub {
        font-size: 0.72rem;
        color: var(--gray-500);
      }

      .status-badge {
        font-size: 0.78rem;
        border-radius: 9999px;
        padding: 0.12rem 0.6rem;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        justify-content: center;
      }

      .status-badge.ok {
        background-color: var(--green-50);
        color: var(--green-600);
      }

      .status-badge.soon {
        background-color: var(--yellow-50);
        color: var(--yellow-500);
      }

      .status-badge.bad {
        background-color: var(--red-50);
        color: var(--red-500);
      }

      .empty-state {
        padding: 1rem;
        font-size: 0.8rem;
        color: var(--gray-600);
        text-align: center;
      }

      /* Sidebar stats */
      .stat-block {
        margin-bottom: 0.8rem;
        padding-bottom: 0.7rem;
        border-bottom: 1px dashed var(--gray-200);
      }

      .stat-block:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }

      .stat-label {
        font-size: 0.8rem;
        color: var(--gray-600);
        margin-bottom: 0.15rem;
      }

      .stat-value-row {
        display: flex;
        align-items: baseline;
        gap: 0.3rem;
        margin-bottom: 0.15rem;
      }

      .stat-number {
        font-size: 1.2rem;
        font-weight: 600;
      }

      .stat-unit {
        font-size: 0.8rem;
        color: var(--gray-500);
      }

      .stat-helper {
        font-size: 0.76rem;
        color: var(--gray-500);
      }

      .stat-pills-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
        margin-top: 0.4rem;
      }

      .stat-pill {
        font-size: 0.72rem;
        border-radius: 9999px;
        padding: 0.1rem 0.5rem;
        border: 1px dashed var(--gray-200);
        color: var(--gray-600);
      }

      .small-muted {
        font-size: 0.75rem;
        color: var(--gray-500);
      }

      .danger-text {
        color: var(--red-500);
      }

      footer {
        border-top: 1px solid var(--gray-200);
        background-color: #ffffff;
      }

      .footer-inner {
        max-width: 64rem;
        margin: 0 auto;
        padding: 0.8rem 1rem;
        font-size: 0.78rem;
        color: var(--gray-600);
        display: flex;
        justify-content: space-between;
        gap: 0.75rem;
        flex-wrap: wrap;
      }

      @media (max-width: 640px) {
        .navbar-inner {
          flex-direction: column;
          align-items: flex-start;
        }

        .navbar-links {
          width: 100%;
          overflow-x: auto;
        }

        .table-header,
        .table-row {
          grid-template-columns: minmax(0, 2.5fr) minmax(0, 1.2fr) minmax(
              0,
              1fr
            );
        }

        .table-header div:nth-child(3),
        .table-row > div:nth-child(3) {
          display: none;
        }

        .footer-inner {
          flex-direction: column;
          align-items: flex-start;
        }
      }

      .navbar {
  background-color: #ffffff;
  border-bottom: 1px solid var(--gray-200);
}

.navbar-inner {
  max-width: 64rem;
  margin: 0 auto;
  padding: 0.6rem 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}

.navbar-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
}

.navbar-brand {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 600;
  font-size: 1rem;
}

.brand-icon {
  width: 20px;
  height: 20px;
}

.navbar-links {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.9rem;
}

/* Link base */
.nav-link {
  padding: 0.4rem 0.7rem;
  border-radius: 9999px;
  color: var(--gray-600);
  text-decoration: none;
}

.nav-link:hover {
  background-color: var(--gray-100);
  color: var(--gray-900);
}

.nav-link.active {
  background-color: var(--blue-50);
  color: var(--blue-600);
  font-weight: 500;
}

/* Bottone hamburger */
.nav-toggle {
  display: none; /* visibile solo su mobile */
  border: none;
  background: transparent;
  padding: 0.3rem;
  border-radius: 9999px;
  cursor: pointer;
}

.nav-toggle:hover {
  background-color: var(--gray-100);
}

.nav-toggle-icon {
  width: 22px;
  height: 22px;
}

/* Layout mobile-first */
@media (max-width: 768px) {
  .navbar-inner {
    padding-inline: 0.75rem;
  }

  .navbar-links {
    width: 100%;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.4rem;
    padding-top: 0.4rem;
    border-top: 1px solid var(--gray-100);
    display: none;           /* chiuso di default */
  }

  .navbar-links.open {
    display: flex;           /* aperto quando c'è .open */
  }

  .nav-toggle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .nav-link {
    width: 100%;
    padding: 0.5rem 0.6rem;
  }
}

@media (min-width: 769px) {
  .navbar-inner {
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
  }

  .navbar-links {
    display: flex !important; /* sempre visibile su desktop */
    border-top: none;
    padding-top: 0;
  }
}

    </style>
  </head>
  <body>
    <div class="page">
      <!-- Navbar -->
      <header class="navbar">
  <div class="navbar-inner">
    <div class="navbar-top">
      <a href="index.html" class="navbar-brand">
        <i data-lucide="scan-line" class="brand-icon"></i>
        <span>Nasometro Digitale</span>
      </a>

      <button id="navToggle" class="nav-toggle" aria-label="Apri menu">
        <i data-lucide="menu" class="nav-toggle-icon"></i>
      </button>
    </div>

    <nav id="navMenu" class="navbar-links">
      <a href="index.html" class="nav-link ">Home</a>
      <a href="analisi.html" class="nav-link">Analisi</a>
      <a href="storico.html" class="nav-link active">Storico</a>
      <a href="impostazioni.html" class="nav-link">Impostazioni</a>
      <a href="informazioni.html" class="nav-link">Info</a>
    </nav>
  </div>
</header>

      <main>
        <div class="main-inner">
          <h1>Storico analisi</h1>
          <p class="page-subtitle">
            Rivedi le ultime valutazioni effettuate con il Nasometro Digitale.
            I dati sono salvati solo nel tuo browser e puoi cancellarli in
            qualsiasi momento.
          </p>

          <div class="layout">
            <!-- Lista -->
            <section class="card">
              <div class="card-header-row">
                <div>
                  <h2 class="card-title">Alimenti analizzati</h2>
                  <p class="card-subtitle" id="summaryText">
                    Caricamento storico...
                  </p>
                </div>
              </div>

              <div class="filters-row">
                <div class="chips">
                  <button
                    type="button"
                    class="chip-filter active"
                    data-filter="all"
                  >
                    <i
                      data-lucide="list-filter"
                      style="width: 14px; height: 14px"
                    ></i>
                    Tutti
                  </button>
                  <button
                    type="button"
                    class="chip-filter"
                    data-filter="ok"
                  >
                    <span
                      style="
                        width: 8px;
                        height: 8px;
                        border-radius: 9999px;
                        background-color: var(--green-600);
                      "
                    ></span>
                    Ancora buoni
                  </button>
                  <button
                    type="button"
                    class="chip-filter"
                    data-filter="soon"
                  >
                    <span
                      style="
                        width: 8px;
                        height: 8px;
                        border-radius: 9999px;
                        background-color: var(--yellow-500);
                      "
                    ></span>
                    Da consumare
                  </button>
                  <button
                    type="button"
                    class="chip-filter"
                    data-filter="bad"
                  >
                    <span
                      style="
                        width: 8px;
                        height: 8px;
                        border-radius: 9999px;
                        background-color: var(--red-500);
                      "
                    ></span>
                    Da eliminare
                  </button>
                </div>

                <button type="button" id="clearBtn" class="btn-ghost-sm">
                  <i
                    data-lucide="trash-2"
                    style="width: 14px; height: 14px"
                  ></i>
                  Svuota storico
                </button>
              </div>

              <div class="table-header">
                <div>Alimento</div>
                <div>Data analisi</div>
                <div>Posizione</div>
                <div>Stato</div>
              </div>

              <div class="table-body" id="tableBody">
                <!-- Righe generate via JS -->
              </div>
            </section>

            <!-- Pannello laterale -->
            <aside class="card">
              <div class="card-header-row" style="margin-bottom: 0.5rem">
                <div>
                  <h2 class="card-title">Statistiche sintetiche</h2>
                  <p class="card-subtitle">
                    Più utilizzi il Nasometro, più avrai uno storico utile.
                  </p>
                </div>
              </div>

              <div class="stat-block">
                <div class="stat-label">Analisi totali registrate</div>
                <div class="stat-value-row">
                  <span class="stat-number" id="statTotal">0</span>
                  <span class="stat-unit">voci</span>
                </div>
                <p class="stat-helper">
                  Include solo i dati presenti nello storico locale.
                </p>
              </div>

              <div class="stat-block">
                <div class="stat-label">Distribuzione stato alimenti</div>
                <div class="stat-value-row">
                  <span class="stat-number" id="statOk">0</span>
                  <span class="stat-unit">OK</span>
                </div>
                <div class="stat-value-row">
                  <span class="stat-number" id="statSoon">0</span>
                  <span class="stat-unit">da consumare</span>
                </div>
                <div class="stat-value-row">
                  <span class="stat-number" id="statBad">0</span>
                  <span class="stat-unit">da eliminare</span>
                </div>

                <div class="stat-pills-row">
                  <span class="stat-pill" id="ratioOk">–</span>
                  <span class="stat-pill" id="ratioSoon">–</span>
                  <span class="stat-pill" id="ratioBad">–</span>
                </div>
              </div>

              <div class="stat-block">
                <div class="stat-label">Privacy</div>
                <p class="small-muted">
                  Lo storico è memorizzato in <code>localStorage</code> del tuo
                  browser. Eliminando i dati li rimuovi solo dal dispositivo
                  corrente.
                </p>
                <p class="small-muted danger-text" style="margin-top: 0.3rem">
                  Non utilizzare questa demo come unico strumento di sicurezza
                  alimentare.
                </p>
              </div>
            </aside>
          </div>
        </div>
      </main>

      <footer>
        <div class="footer-inner">
          <span>Nasometro Digitale • Versione 1.0.0</span>
          <span>Puoi azzerare lo storico in qualsiasi momento dal pannello.</span>
        </div>
      </footer>
    </div>

    <script>
      lucide.createIcons();

      const STORAGE_KEYS = {
        stats: 'nasometro_stats',
        recent: 'nasometro_recent_items'
      };

      function readJSON(key, fallback) {
        const raw = localStorage.getItem(key);
        if (!raw) return fallback;
        try {
          return JSON.parse(raw);
        } catch {
          return fallback;
        }
      }

      function writeJSON(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
      }

      function getStats() {
        return readJSON(STORAGE_KEYS.stats, { ok: 0, soon: 0, bad: 0 });
      }

      function getRecent() {
        return readJSON(STORAGE_KEYS.recent, []);
      }

      const summaryText = document.getElementById('summaryText');
      const tableBody = document.getElementById('tableBody');
      const filterButtons = document.querySelectorAll('.chip-filter');
      const clearBtn = document.getElementById('clearBtn');

      const statTotal = document.getElementById('statTotal');
      const statOk = document.getElementById('statOk');
      const statSoon = document.getElementById('statSoon');
      const statBad = document.getElementById('statBad');
      const ratioOk = document.getElementById('ratioOk');
      const ratioSoon = document.getElementById('ratioSoon');
      const ratioBad = document.getElementById('ratioBad');

      let currentFilter = 'all';
      let items = getRecent();

      function formatLocation(loc) {
        if (!loc) return 'Frigo';
        if (loc === 'frigo') return 'Frigorifero';
        if (loc === 'freezer') return 'Freezer';
        if (loc === 'dispensa') return 'Dispensa';
        return loc;
      }

      function statusLabel(status) {
        if (status === 'ok') return 'OK';
        if (status === 'soon') return 'Da consumare';
        return 'Da eliminare';
      }

      function renderTable() {
        tableBody.innerHTML = '';

        let filtered = items;
        if (currentFilter !== 'all') {
          filtered = items.filter((it) => it.status === currentFilter);
        }

        if (!filtered.length) {
          const empty = document.createElement('div');
          empty.className = 'empty-state';
          empty.textContent =
            currentFilter === 'all'
              ? 'Lo storico è vuoto. Analizza un alimento per iniziare a popolare questa sezione.'
              : 'Nessun alimento con questo stato nel periodo salvato.';
          tableBody.appendChild(empty);
          return;
        }

        filtered.forEach((item) => {
          const row = document.createElement('div');
          row.className = 'table-row';

          const cellName = document.createElement('div');
          cellName.className = 'item-name-cell';

          const iconWrap = document.createElement('div');
          iconWrap.className = 'item-icon';
          const icon = document.createElement('i');
          icon.setAttribute('data-lucide', 'utensils');
          icon.style.width = '14px';
          icon.style.height = '14px';
          iconWrap.appendChild(icon);

          const nameMain = document.createElement('div');
          nameMain.className = 'item-name-main';
          const nameTitle = document.createElement('div');
          nameTitle.className = 'item-name-title';
          nameTitle.textContent = item.name || 'Alimento';
          const nameSub = document.createElement('div');
          nameSub.className = 'item-name-sub';
          nameSub.textContent = formatLocation(item.location);

          nameMain.appendChild(nameTitle);
          nameMain.appendChild(nameSub);

          cellName.appendChild(iconWrap);
          cellName.appendChild(nameMain);

          const cellDate = document.createElement('div');
          cellDate.textContent = item.date || '-';

          const cellLocation = document.createElement('div');
          cellLocation.textContent = formatLocation(item.location);

          const cellStatus = document.createElement('div');
          const badge = document.createElement('span');
          badge.className = 'status-badge ' + (item.status || 'ok');
          badge.textContent = statusLabel(item.status);
          cellStatus.appendChild(badge);

          row.appendChild(cellName);
          row.appendChild(cellDate);
          row.appendChild(cellLocation);
          row.appendChild(cellStatus);

          tableBody.appendChild(row);
        });

        lucide.createIcons();
      }

      function updateSummary() {
        const total = items.length;
        if (!total) {
          summaryText.textContent =
            'Nessuna analisi salvata al momento su questo dispositivo.';
          return;
        }

        const latest = items[0];
        summaryText.textContent =
          'Totale voci: ' +
          total +
          '. Ultima analisi: ' +
          (latest.name || 'alimento') +
          ' in data ' +
          (latest.date || '-');
      }

      function updateStatsPanel() {
        const stats = getStats();
        const total = (stats.ok || 0) + (stats.soon || 0) + (stats.bad || 0);

        statTotal.textContent = items.length;
        statOk.textContent = stats.ok || 0;
        statSoon.textContent = stats.soon || 0;
        statBad.textContent = stats.bad || 0;

        if (!total) {
          ratioOk.textContent = 'Nessun dato';
          ratioSoon.textContent = 'Nessun dato';
          ratioBad.textContent = 'Nessun dato';
          return;
        }

        const pct = (n) => Math.round((n / total) * 100) + '%';

        ratioOk.textContent = 'OK: ' + pct(stats.ok || 0);
        ratioSoon.textContent = 'Da consumare: ' + pct(stats.soon || 0);
        ratioBad.textContent = 'Da eliminare: ' + pct(stats.bad || 0);
      }

      filterButtons.forEach((btn) => {
        btn.addEventListener('click', () => {
          filterButtons.forEach((b) => b.classList.remove('active'));
          btn.classList.add('active');
          currentFilter = btn.getAttribute('data-filter');
          renderTable();
        });
      });

      clearBtn.addEventListener('click', () => {
        if (
          !confirm(
            'Vuoi davvero svuotare lo storico locale? Questa azione non è reversibile.'
          )
        ) {
          return;
        }
        items = [];
        writeJSON(STORAGE_KEYS.recent, items);
        // opzionale: azzera anche le stats
        writeJSON(STORAGE_KEYS.stats, { ok: 0, soon: 0, bad: 0 });
        renderTable();
        updateSummary();
        updateStatsPanel();
      });

      // Inizializzazione
      renderTable();
      updateSummary();
      updateStatsPanel();
    </script>
    <script>
  // Inizializza icone Lucide (se non lo hai già in pagina, tieni solo una chiamata)
  lucide.createIcons();

  const navToggle = document.getElementById('navToggle');
  const navMenu = document.getElementById('navMenu');

  if (navToggle && navMenu) {
    navToggle.addEventListener('click', () => {
      const isOpen = navMenu.classList.toggle('open');
      // Cambia icona menu / X
      navToggle.innerHTML = '';
      const icon = document.createElement('i');
      icon.setAttribute('data-lucide', isOpen ? 'x' : 'menu');
      icon.className = 'nav-toggle-icon';
      navToggle.appendChild(icon);
      lucide.createIcons();
    });

    // Chiudi menu al click su un link (mobile UX)
    navMenu.querySelectorAll('a.nav-link').forEach((link) => {
      link.addEventListener('click', () => {
        if (window.innerWidth <= 768 && navMenu.classList.contains('open')) {
          navMenu.classList.remove('open');
          navToggle.innerHTML = '';
          const icon = document.createElement('i');
          icon.setAttribute('data-lucide', 'menu');
          icon.className = 'nav-toggle-icon';
          navToggle.appendChild(icon);
          lucide.createIcons();
        }
      });
    });
  }
</script>

  </body>
</html>
